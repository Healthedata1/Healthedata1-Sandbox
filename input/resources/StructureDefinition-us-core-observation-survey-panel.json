{
    "resourceType": "StructureDefinition",
    "id": "us-core-observation-survey-panel",
    "url": "http://www.fhir.org/guides/healthedata1-sandbox/StructureDefinition/us-core-observation-survey-panel",
    "name": "USCoreObservationSurveyPanelProfile",
    "title": "US Core Observation Survey Panel Profile",
    "status": "active",
    "date": "2022-03-17",
    "description": "Profile for Observations that represent panels derived surveys/questionnaires.  This profile along with the US Core Observation Survey Panel Profile is used represent SDOH assessments and meets the  U.S. Core Data for Interoperability (USCDI) v2 SDOH Assessments requirements.",
    "fhirVersion": "4.0.1",
    "kind": "resource",
    "abstract": false,
    "type": "Observation",
    "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Observation",
    "derivation": "constraint",
    "differential": {
        "element": [
            {
                "id": "Observation",
                "path": "Observation",
                "short": "Survey Panel Observation",
                "definition": "Profile for Observations that represent panels derived surveys/questionnaires.  This profile along with the US Core Observation Survey Panel Profile is used represent SDOH assessments and meets the  U.S. Core Data for Interoperability (USCDI) v2 SDOH Assessments requirements.",
                "comment": "This profile along with the US Core Observation Survey Panel Profile is used represent SDOH assessments and meets the U.S. Core Data for Interoperability (USCDI) v2 SDOH Assessments requirements.",
                "constraint": [
                    {
                        "key": "us-core-2",
                        "severity": "error",
                        "human": "If there is no component or hasMember element then either a value[x] or a data absent reason must be present",
                        "expression": "(component.empty() and hasMember.empty()) implies (dataAbsentReason.exists() or value.exists())",
                        "xpath": "exists(f:component) or exists(f:hasMember) or exists(f:*[starts-with(local-name(.), 'value')]) or exists(f:dataAbsentReason)"
                    }
                ]
            },
            {
                "id": "Observation.status",
                "path": "Observation.status",
                "mustSupport": true
            },
            {
                "id": "Observation.category",
                "path": "Observation.category",
                "slicing": {
                    "discriminator": [
                        {
                            "type": "pattern",
                            "path": "$this"
                        }
                    ],
                    "rules": "open"
                },
                "requirements": "To identify that observation is derived from a questionnaire.",
                "min": 1,
                "mustSupport": true
            },
            {
                "id": "Observation.category:survey",
                "path": "Observation.category",
                "sliceName": "survey",
                "requirements": "Used for filtering what that this is an observation derived from a survey/questionnaire.",
                "min": 1,
                "max": "1",
                "patternCodeableConcept": {
                    "coding": [
                        {
                            "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                            "code": "survey"
                        }
                    ]
                },
                "mustSupport": true
            },
            {
                "id": "Observation.category:sdoh",
                "path": "Observation.category",
                "sliceName": "sdoh",
                "requirements": "Used for filtering what that this is an observation derived from an SDOH survey/questionnaire.",
                "min": 0,
                "max": "1",
                "patternCodeableConcept": {
                    "coding": [
                        {
                            "system": "http://loinc.org",
                            "code": "LG41762-2"
                        }
                    ]
                },
                "mustSupport": true
            },
            {
                "id": "Observation.code",
                "path": "Observation.code",
                "mustSupport": true,
                "binding": {
                    "strength": "preferred",
                    "valueSet": "http://hl7.org/fhir/us/core/ValueSet/us-core-common-survey-panels"
                }
            },
            {
                "id": "Observation.subject",
                "path": "Observation.subject",
                "min": 1,
                "type": [
                    {
                        "code": "Reference",
                        "targetProfile": [
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"
                        ]
                    }
                ],
                "mustSupport": true
            },
            {
                "id": "Observation.effective[x]",
                "path": "Observation.effective[x]",
                "definition": "The time or time-period the observed value is asserted as being true. For biological subjects - e.g. human patients - this is usually called the \"physiologically relevant time\".",
                "comment": "At least a date should be present unless this observation is a historical report.",
                "type": [
                    {
                        "extension": [
                            {
                                "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                "valueBoolean": true
                            }
                        ],
                        "code": "dateTime"
                    },
                    {
                        "code": "Period"
                    },
                    {
                        "code": "Timing"
                    },
                    {
                        "code": "instant"
                    }
                ],
                "condition": [
                    "us-core-1"
                ],
                "constraint": [
                    {
                        "key": "us-core-1",
                        "severity": "error",
                        "human": "Datetime must be at least to day.",
                        "expression": "$this is DateTime implies $this.toString().length() >= 10",
                        "xpath": "f:matches(effectiveDateTime,/\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z)/)"
                    }
                ],
                "mustSupport": true
            },
            {
                "id": "Observation.performer",
                "path": "Observation.performer",
                "comment": "Some questions on questionnaires are not answered directly (e.g., asserted) by the individual completing the questionnaire, but are derived from answers to one or more other questions. For types of answers, `Observation.performer` should not be specified and `Observation.derivedFrom` should reference the relevant Screening Response Observation(s).",
                "type": [
                    {
                        "code": "Reference",
                        "targetProfile": [
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-practitioner",
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-organization",
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient",
                            "http://hl7.org/fhir/StructureDefinition/PractitionerRole",
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-careteam",
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-relatedperson"
                        ],
                        "_targetProfile": [
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": true
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "mustSupport": true
            },
            {
                "id": "Observation.hasMember",
                "path": "Observation.hasMember",
                "short": "Individual Observations that belong to a \u201csurvey panel\u201d.",
                "definition": "Aggregate set of Observations that represent a individual questions belonging to a single panel.",
                "comment": "This grouping element is used to represent surveys that group several questions together. For example in the simplest case a flat multi-question survey where the \"panel\" observation is the survey instrument  itself and instead of an `Observation.value` the `hasMember` element references other Observation that represent the individual questions answer pairs. In a survey that has a heirarchical grouping of questions, the observation \"panels\" can be nested. Because surveys can be arbitrarily complex structurally, not all survey structures can be represented using this Observation grouping pattern.",
                "type": [
                    {
                        "code": "Reference",
                        "targetProfile": [
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-survey-item",
                            "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
                            "http://hl7.org/fhir/StructureDefinition/MolecularSequence"
                        ],
                        "_targetProfile": [
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": true
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "mustSupport": true
            },
            {
                "id": "Observation.derivedFrom",
                "path": "Observation.derivedFrom",
                "short": "Related Observations or QuestionnaireResponses that the observation is made from",
                "definition": "Observations or QuestionnaireResponses from which this observation value is derived.",
                "type": [
                    {
                        "code": "Reference",
                        "targetProfile": [
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-observation-screening-response",
                            "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
                            "http://hl7.org/fhir/us/core/StructureDefinition/us-core-documentreference",
                            "http://hl7.org/fhir/StructureDefinition/ImagingStudy",
                            "http://hl7.org/fhir/StructureDefinition/Media",
                            "http://hl7.org/fhir/StructureDefinition/MolecularSequence"
                        ],
                        "_targetProfile": [
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": true
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": true
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            },
                            {
                                "extension": [
                                    {
                                        "url": "http://hl7.org/fhir/StructureDefinition/elementdefinition-type-must-support",
                                        "valueBoolean": false
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "mustSupport": true
            }
        ]
    }
}